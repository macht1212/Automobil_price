# Анализ объявлений о продаже автомобилей с сайта drom.ru с целью построения регрессионной модели для предсказания стоимости автомобиля  

## Введение

Идея создания модели появилась в процессе изучения курса машинного обучения для тренировки навыков, полеченных в процессе обучения.  
Часто при продаже автомобиля, многие автовладельцы ставят стоимость своего автомобиля не совсем корректно, то есть либо выше рынка, либо ниже.
Использование модели регрессии, которая была предобучена на достаточно большом датасете, который позволяет собрать сайт (примерно 2000 объявлений), 
должно помочь с пониманием средней стоимости автомобиля.

## Получение данных
Данные были получены из открытых источников, а именно с сайта drom.ru при помощи написанного самолично парсера с использованием библиотек requests и beautifulsoup4.
Данные сохранялись в файл с расширением .csv и названием, включающим в себя дату парсинга. Парсились данные легковых автомобилей.  

## Описание датасета

Датасет состоит из 11 признаков:  
1. name - Марка и модель автомобиля
2. year - Год выпуска автомобиля
3. engine_capacity - Объем двигателя (л)
4. horse_power - Мощность двигателя (л. с.)
5. fuel - Тип топлива
6. transmission - Каробка передач
7. drive_unit - Привод
8. mileage - Пробег (км)
9. location - Место продажи
10. price - Стоимость автомобиля

В последствии при подготовке данных для модели регрессии признак name был разделен на два: name (Марка автомобиля) и model (Модель автомобиля)

## Анализ данных

### Общая информация о датасете
Всего было проанализированно 1974 объявления, размещенных на сайте на момент 19 декабря 2023 года.  
 
![bar-plot-top-15](/img/ТОП-15%20самых%20продаваемых%20марок%20автомобилей.png)

Наибольшее количество объявлений принадлежит основной российской марке автомобилей Лада (319 объявлений). На данный момент в Россию ввозится достаточно большое количество автомобилей из Китая, но они пока составляют небольшую часть от всех объявлений.
![bar-plot-top-10](/img/ТОП-10%20самых%20продаваемых%20моледей%20Лады.png)  
При этом наибольшее количество объявлений у модели Гранты.  

На втором месте располагается вторая "народная" марка автомобилей Toyota (196 объявлений).  
![bar-plot-top-10](/img/ТОП-10%20самых%20продаваемых%20моледей%20Toyota.png)  

Самое большое количество объявлений принадлежит Москве, что в целом логично, так как Москва - крупнейший город. На втором месте - Санкт-Петербург.  
![bar-plot-top-15](/img/ТОП-15%20городов%20по%20количеству%20объявлений.png)   

### Детальная информация

Распределение стоимости автомобилей, согласно проведенному тесту Шапиро-Уилка, нормальное, со смещением в левую сторону (в сторону низкой стоимости).  
![hist-plot-price](/img/Распределение%20цен%20автомобилей.png)  
Стоит также отметить, что в датасете присутствуют стоимости, значительно превышающие среднюю (квантиль 2), что в последствии может навредить обучающейся модели регрессии. 

Распределение пробега автомобилей также, согласно проведенному тесту Шапиро-Уилка, нормальное, со смещением в левую сторону (в сторону малого пробега). 
![hist-plot-mileage](/img/Распределение%20пробега%20автомобилей.png)  
В случае пробега, выбросов не много, большая часть данных входит в диапазон [q1-1,5%; q3+1,5%].

Самыми популярными коробками передач являются АКПП и МКПП, вариатор и роботизированная КПП не так распространены, за счет своей относительной новизны.  
![bar-plot-transmission](/img/Варианты%20коробки%20передач.png)

Бензин на данный момент является безоговорочным лидером среди типов топлива.  
![bar-plot-fuel](/img/Варианты%20топлива.png)  

Распределение объема двигателя, согласно проведенному тесту Шапиро-Уилка, нормальное. Среднее значение объема двигателя около 2 л.  
![hist-plot-engine_cap](/img/Распределение%20значений%20объема%20двигателя.png)  

Распределение мощности двигателя, согласно проведенному тесту Шапиро-Уилка, нормальное. Среднее значение на уровне 150-160 л.с.  
![hist-plot-horse_pow](/img/Распределение%20значений%20мощности%20двигателя.png)  

Согласно корреляционной матрицы Спирмана, основное влияние числовых признаков на стоимость оказывают Мощность двигателя (0.75) и Год производства автомобиля (0.8).  
![corr-plot-spearman](/img/spearman.png)  

## Подготовка датасета для обучения модели

1. Удаление выбросов
2. Перевод категориальных значений в числовые (Count Encoder или Label Encoder)
3. Разделение данных на тренировочную и тестовую выборки (sklearn: train_test_split). Размер тестовой выборки составил 20%.  
4. Выбор модели регрессии (RandomForestRegressor из библиотеки sklearn или XGBRegressor из библиотеки xgboost)
5. Обучение и тестирование модели  
6. Сохранение предобученной модели

## Результаты

Наилучший результат показала модель регрессии XGBRegressor с модифицировнными категориальными признаками через Count Encoder:  
* Accuracy тренировочной выборки: 0.99078
* Accuracy тестовой выборки: 0.94262

## Использование модели

Для использования модели создано приложение на основе streamlit.  


